<!DOCTYPE html>
<html lang="en">

<head>
    {% block head %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Free Artist Tools by cecilieo.com">
    <meta name="author" content="Shinichi Okada">

    <title>{% block title %}{% endblock %} Bias remover</title>
    <link rel="icon" href="{{ url_for('static', path='/images/favicon.ico') }}" sizes="32x32" />

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link href="{{ url_for('static', path='/css/style3.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', path='/css/mystyle.css') }}" rel="stylesheet">

    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Font Awesome JS -->
    <script src="https://kit.fontawesome.com/543c4560e5.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/aruminant/tinyq@v1.0.1/dist/tinyquoter.min.js"></script>
    {% endblock %}
</head>

<body>
    <div class="wrapper">
        <!-- Page Content  -->
        <div id="content">
            {% include 'include/topnav.html' %}
            {% block page_content %}
            {% endblock %}
        </div>
    </div>
    <div class="overlay"></div>


    {% block scripts %}

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous">
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous">
    </script>
    <!-- jQuery Custom Scroller CDN -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js">
    </script>

    <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>


    <script type="text/javascript">
        var highlite = function () {
            var val = $(this).text()
            val = val.replace(
                /\b(Strong)|\b(Active)|\b(Affectionate)|\b(Adventurous)|\b(Child\w*)|\b(Aggress\w*)|\b(Cheer\w*)|\b(Ambitio\w*)|\b(Commit\w*)|\b(Analy\w*)|\b(Communal)|\b(Assert\w*)|\b(Compassion\w*)|\b(Athlet\w*)|\b(Connect\w*)|\b(Autonom\w*)|\b(Considerate)|\b(Boast\w*)|\b(Cooperat\w*)|\b(Challeng\w*)|\b(Depend\w*)|\b(Compet\w*)|\b(Emotiona\w*)|\b(Confident)|\b(Empath\w*)|\b(Courag\w*)|\b(Feminine)|\b(Decide)|\b(Flatterable)|\b(Decisive)|\b(Gentle)|\b(Decision\w*)|\b(Honest)|\b(Determin\w*)|\b(Interpersonal)|\b(Dominant)|\b(Interdependen\w*)|\b(Domina\w*)|\b(Interpersona\w*)|\b(Force\w*)|\b(Kind)|\b(Greedy)|\b(Kinship)|\b(Headstrong)|\b(Loyal\w*)|\b(Hierarch\w*)|\b(Modesty)|\b(Hostil\w*)|\b(Nag)|\b(Implusive)|\b(Nurtur\w*)|\b(Independen\w*)|\b(Pleasant\w*)|\b(Individual\w*)|\b(Polite)|\b(Intellect\w*)|\b(Quiet\w*)|\b(Lead\w*)|\b(Logic)|\b(Sensitiv\w*)|\b(Masculine)|\b(Submissive)|\b(Objective)|\b(Support\w*)|\b(Opinion)|\b(Sympath\w*)|\b(Outspoken)|\b(Tender\w*)|\b(Persist)|\b(Together\w*)|\b(Principle\w*)|\b(Trust\w*)|\b(Reckless)|\b(Understand\w*)|\b(Stubborn)|\b(Warm\w*)|\b(Superior)|\b(Whin\w*)|\b(Self-confiden\w*)|\b(Yield\w*)/ig,
                "<span class='highlight'>$&</span>")

            
            $(this).replaceWith("<p>" + val + "</p>")
        }

        

        function askGPT(paragraphContainer,parent) {
        
            let req = $.post({
                        url: "/api",
                        data: JSON.stringify({
                            "data": paragraphContainer.textContent
                        }),
                        //contentType: "application/json",
                        //dataType: 'json',
                    });
                    req.done(function (response) {
                        $(paragraphContainer).fadeOut(500)
                        res = JSON.parse(response)

                        $(paragraphContainer)
                            .text(function (index, text) {
                                return res.data;
                            })
                        $(paragraphContainer).map(highlite)
                        $(paragraphContainer).fadeIn(500)
                        $(parent).addClass("changed")
                        tippy(paragraphContainer, {
                            content:`<div class="show" >
                                <button type="button" class="btn btn-primary paraphraseit">Paraphrase it using GPT</button>
                                </div>`,
                            allowHTML: true,
                            hideOnClick: true,
                            trigger: 'mouseenter click focus',
                            delay: [null, 100],
                            interactive: true,

                            onShow(instance) {
                                $(instance.popper).find("button")[0].onclick = function(){
                                    var $this = $(this);
                                    $this.addClass('disabled').html("Loading...");
                                    
                                    setTimeout(function(){
                                        $this.removeClass('disabled').html('Paraphrase it using GPT');

                                    },1000)
                                    askGPT(instance.reference,instance.reference.parentElement)
                                }
                                
                            },
                        });
                    })
        }



        tippy(".d-none.d-lg-block",{
            
            content:"Hover on the buletpoints to paraphrase it! "

        })



        $(document).ready(function () {
             $("#sidebar").mCustomScrollbar({
                 theme: "minimal"
             });
            
            $("li p").each(highlite)

        tippy('li p', {
            content:`<div class="show" >
            <button type="button" class="btn btn-primary paraphraseit">Paraphrase it using GPT</button>
                        </div>`,
            allowHTML: true,
            hideOnClick: true,
            trigger: 'mouseenter click focus',
            delay: [null, 100],
            interactive: true,

            onShow(instance) {
                    console.log(instance.reference);
                    $(instance.popper).find("button")[0].onclick = function(){
                        var $this = $(this);
                        $this.addClass('disabled').html("Loading...");
                        
                        setTimeout(function(){
                            $this.removeClass('disabled').html('Paraphrase it!');

                        },1000)
                        askGPT(instance.reference,instance.reference.parentElement)
                    }    
                },
        });
        //     $('#dismiss, .overlay').on('click', function () {
        //         $('#sidebar').removeClass('active');
        //         $('.overlay').removeClass('active');
        //     });

        //     $('#sidebarCollapse').on('click', function () {
        //         $('#sidebar').addClass('active');
        //         $('.overlay').addClass('active');
        //         $('.collapse.in').toggleClass('in');
        //         $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        //     });
        
        });
    </script>
    {% endblock %}
</body>

</html>